# 装备切换动作

装备切换动作可保存一套装备快照，并在背包内查找匹配物品后重新装备。

## 目标槽位

可配置以下槽位：

- 主手
- 副手
- 头盔
- 胸甲
- 护腿
- 靴子

如果编辑器里某个槽位留空，执行时会跳过该槽位。

## 创建步骤

1. 点击 `Add Item Equip`。
2. 设置标题 / 备注 / 图标。
3. 从来源物品网格拖拽物品到目标槽位。
4. 保存。

### 来源网格包含

- 当前副手物品
- 已穿戴护甲
- 主背包
- 快捷栏

## 执行时行为

从径向菜单触发后：

1. 逐个检查已配置目标槽位。
2. 若目标槽已匹配记录物品，则跳过。
3. 否则在来源中查找最佳匹配堆叠。
4. 交换到目标槽位。

处理是逐槽位进行，允许部分成功。

## 关键匹配规则

- 匹配基于完整物品快照签名（含 NBT / 元数据），不比较数量。
- 若有多个匹配堆叠，会优先选择数量最多的那个。

## 主手规则

`Mainhand` 表示触发瞬间玩家当前选中的快捷栏槽位。

## 高压场景行为

- 若一个装备切换还在执行时又触发另一个，旧任务会被取消并替换。
- 执行在后台 tick 进行，移动和常规操作可继续。

## 编辑器快捷操作

- 左键从来源拖到目标槽：设置槽位物品。
- 右键目标槽：清空该槽位。
- `Refresh Items`：按当前玩家物品状态重建来源列表。

???+ info "深入说明：执行顺序"
    当前执行顺序：

    1. 头盔
    2. 胸甲
    3. 护腿
    4. 靴子
    5. 副手
    6. 主手

    空目标或缺少匹配来源会被跳过，不算硬失败。
